{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nvar _jsxFileName = \"/Users/jackmay/learning-dev/graphql-app/jackstagram/client/lib/secureRoute.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Router from 'next/router';\nimport nextCookie from 'next-cookies';\nimport { Query, withApollo } from 'react-apollo';\nimport { SINGLE_USER_QUERY } from '../lib/query';\n\nconst secureRoute = Component => {\n  class Wrapper extends React.Component {\n    render() {\n      return __jsx(Query, {\n        query: SINGLE_USER_QUERY,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 11\n        },\n        __self: this\n      }, ({\n        data,\n        error\n      }) => {\n        if (error) return __jsx(Component, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 13\n          },\n          __self: this\n        });\n        return __jsx(Component, _extends({}, data, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 14\n          },\n          __self: this\n        }));\n      });\n    }\n\n  }\n\n  Wrapper.getInitialProps = async ctx => {\n    const {\n      token\n    } = nextCookie(ctx);\n\n    if (!token && ctx.res) {\n      ctx.res.writeHead(302, {\n        Location: '/login'\n      });\n      ctx.res.end();\n      return;\n    }\n\n    if (!token) {\n      Router.push('/login');\n    }\n\n    return {\n      token\n    };\n  };\n\n  return Wrapper;\n};\n\nexport default withApollo(secureRoute);","map":{"version":3,"sources":["/Users/jackmay/learning-dev/graphql-app/jackstagram/client/lib/secureRoute.js"],"names":["Router","nextCookie","Query","withApollo","SINGLE_USER_QUERY","secureRoute","Component","Wrapper","React","render","data","error","getInitialProps","ctx","token","res","writeHead","Location","end","push"],"mappings":";;;;AAAA,OAAOA,MAAP,MAAmB,aAAnB;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,SAASC,KAAT,EAAgBC,UAAhB,QAAkC,cAAlC;AACA,SAASC,iBAAT,QAAkC,cAAlC;;AAEA,MAAMC,WAAW,GAAIC,SAAD,IAAe;AAEjC,QAAMC,OAAN,SAAsBC,KAAK,CAACF,SAA5B,CAAsC;AACpCG,IAAAA,MAAM,GAAG;AACP,aACE,MAAC,KAAD;AAAO,QAAA,KAAK,EAAEL,iBAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACG,CAAC;AAAEM,QAAAA,IAAF;AAAQC,QAAAA;AAAR,OAAD,KAAqB;AACpB,YAAIA,KAAJ,EAAW,OAAO,MAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AACX,eAAO,MAAC,SAAD,eAAeD,IAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAP;AACD,OAJH,CADF;AAQD;;AAVmC;;AAatCH,EAAAA,OAAO,CAACK,eAAR,GAA0B,MAAOC,GAAP,IAAe;AACvC,UAAM;AAAEC,MAAAA;AAAF,QAAYb,UAAU,CAACY,GAAD,CAA5B;;AACA,QAAI,CAACC,KAAD,IAAUD,GAAG,CAACE,GAAlB,EAAuB;AACrBF,MAAAA,GAAG,CAACE,GAAJ,CAAQC,SAAR,CAAkB,GAAlB,EAAuB;AAAEC,QAAAA,QAAQ,EAAE;AAAZ,OAAvB;AACAJ,MAAAA,GAAG,CAACE,GAAJ,CAAQG,GAAR;AACA;AACD;;AAED,QAAI,CAACJ,KAAL,EAAY;AACVd,MAAAA,MAAM,CAACmB,IAAP,CAAY,QAAZ;AACD;;AACD,WAAO;AAAEL,MAAAA;AAAF,KAAP;AACD,GAZD;;AAcA,SAAOP,OAAP;AACD,CA9BD;;AAgCA,eAAeJ,UAAU,CAACE,WAAD,CAAzB","sourcesContent":["import Router from 'next/router'\nimport nextCookie from 'next-cookies'\nimport { Query, withApollo } from 'react-apollo'\nimport { SINGLE_USER_QUERY } from '../lib/query'\n \nconst secureRoute = (Component) => {\n\n  class Wrapper extends React.Component {\n    render() {\n      return (\n        <Query query={SINGLE_USER_QUERY}>\n          {({ data, error }) => {\n            if (error) return <Component />\n            return <Component {...data}/>\n          }}\n        </Query>\n      )\n    }\n  }\n\n  Wrapper.getInitialProps = async (ctx) => {\n    const { token } = nextCookie(ctx)\n    if (!token && ctx.res) {\n      ctx.res.writeHead(302, { Location: '/login' })\n      ctx.res.end()\n      return\n    } \n\n    if (!token) {\n      Router.push('/login')\n    }\n    return { token }\n  }\n  \n  return Wrapper\n}\n\nexport default withApollo(secureRoute)"]},"metadata":{},"sourceType":"module"}